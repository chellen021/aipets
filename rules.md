# 萌宠伙伴项目统一开发规范 V1.0

## 1. 总则与目标

### 1.1 设计原则
- **高可用性**: 关键组件需具备冗余和故障转移能力。
- **可扩展性**: 架构需支持用户量和数据量的增长。
- **高性能**: 优化关键路径，减少响应延迟。
- **安全性**: 设计需全面考虑数据、接口及系统安全。
- **可维护性**: 模块化设计，代码规范，文档齐全。
- **成本效益**: 合理选择技术和资源，控制成本。
- **用户体验优先**: 技术决策应服务于提升用户体验。

### 1.2 项目目标
- **业务目标**: 上线3个月内达到10万注册用户，日活1万，用户日均使用时长15分钟。
- **用户目标**: 提供有趣的虚拟宠物养成体验，满足情感陪伴和社交需求。

## 2. UI/UX 设计规范

### 2.1 色彩系统
- **品牌主色**: `#FF9966` (暖橙色)
- **辅助色**: 信息蓝 (`#66CCFF`), 背景橙 (`#FFF2E8`), 成功绿 (`#99CC66`), 警告黄 (`#FFCC00`), 错误红 (`#FF6B6B`)
- **中性色**: 主要文字 (`#333333`), 次要文字 (`#666666`), 提示文字 (`#999999`), 边框线 (`#EEEEEE`)

### 2.2 字体系统
- **中文字体**: 系统默认 (PingFang SC, Noto Sans CJK SC, Microsoft YaHei)
- **英文/数字字体**: `DIN Alternate` 或 `Nunito Sans`
- **字号规范 (基准)**:
  - 导航栏标题: `36rpx` (加粗)
  - 大标题/金额: `48rpx` (加粗)
  - 正文内容: `28rpx`
  - 辅助说明: `24rpx`
  - 标签/时间戳: `20rpx`
- **行高**: 多行文本为字号的 `1.5` - `1.7` 倍。

### 2.3 布局与间距
- **基本单位**: `8rpx`
- **页面边距**: 左右 `32rpx`
- **组件间距**: `24rpx` - `32rpx`

### 2.4 圆角规范
- **大圆角**: `24rpx` - `32rpx` (用于主要卡片、弹窗)
- **中圆角**: `16rpx` (用于次要卡片、输入框)
- **小圆角**: `8rpx` - `12rpx` (用于按钮、标签)

## 3. 前端开发规范

### 3.1 技术选型
- **基础框架**: 微信小程序原生框架
- **状态管理**: `MobX`
- **UI组件库**: 微信官方 `WeUI` + 自定义业务组件
- **CSS预处理器**: `SCSS`
- **3D渲染**: `threejs-miniprogram`

### 3.2 核心原则
- **组件化**: 优先封装可复用的UI和业务组件。
- **代码规范**: 遵循统一的ESLint配置。
- **性能优先**: 关注启动、加载、渲染和响应速度。
- **分包加载**: 非核心页面和资源放入分包。
- **`setData`优化**: 减少调用频率和数据量。

### 3.3 目录结构
- 遵循 `solution.md` 中定义的标准目录结构，区分 `pages`, `components`, `services`, `store`, `styles`, `utils` 等。

### 3.4 状态管理 (MobX)
- 按业务领域划分Store (`UserStore`, `PetStore`)。
- 使用 `@observable` 标记状态，`@action` 标记修改方法，`@computed` 标记派生值。

## 4. 后端开发规范

### 4.1 技术选型
- **语言/框架**: Node.js + NestJS
- **数据库**: PostgreSQL (用户/关系数据), MongoDB (宠物/非结构化数据), Redis (缓存)
- **消息队列**: RabbitMQ (异步任务)
- **架构**: 微服务架构，通过API网关统一对外服务。

### 4.2 API 设计规范
- **风格**: RESTful，URL路径统一小写，使用中划线 `-`。
- **版本控制**: URL前缀 `/v1/`。
- **请求/响应格式**: 统一使用JSON。
- **标准成功响应**:
  ```json
  {
    "code": 0,
    "message": "Success",
    "data": { ... } 
  }
  ```
- **标准错误响应**:
  ```json
  {
    "code": 40001, 
    "message": "Invalid input parameters.",
    "errors": [ ... ]
  }
  ```
- **身份认证**: 所有受保护接口使用JWT，在 `Authorization: Bearer <token>` 中传递。

### 4.3 数据库设计
- **用户库 (PostgreSQL)**: `users`, `user_login_logs`, `checkin_logs`, `products`, `orders`, `user_inventory`。
- **宠物库 (MongoDB)**: `pets` (存储宠物核心信息和状态), `pet_interactions` (互动记录)。
- **缓存 (Redis)**: 缓存用户会话、用户信息、宠物信息、排行榜数据、签到状态、分布式锁等。

## 5. 测试规范

### 5.1 测试范围
- **功能测试**: 覆盖所有用户故事和功能点。
- **UI/UX测试**: 确保视觉和交互与设计规范一致。
- **API接口测试**: 验证所有API的正确性、性能和安全性。
- **性能测试**: 测试小程序冷启动时间、页面加载速度、AI生成响应时间。
- **安全测试**: 覆盖API授权、XSS注入、文件上传漏洞等。
- **兼容性测试**: 覆盖主流iOS和Android机型及不同微信版本。

### 5.2 测试用例模板
- 必须包含：用例ID、模块、功能点、标题、前置条件、测试步骤、预期结果、优先级、测试类型。

## 6. 版本控制与协作

- **版本控制**: 使用 Git。
- **分支模型**: 推荐使用 GitFlow (master, develop, feature, release, hotfix)。
- **提交信息**: 遵循 Conventional Commits 规范，如 `feat: add user login feature`。